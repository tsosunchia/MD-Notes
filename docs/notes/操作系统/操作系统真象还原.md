![image-20210825125219831](../../images/image-20210825125219831.png)

.ssh 的目录权限极其苛刻

/etc/profile除了环境变量，还有什么？是怎么生效的？

```c
#include <string.h>
#include <unistd.h>
#include <pwd.h>

char user[] = "fucker";
char oops[] = "\0x17\0x1B\0x1B\0x02\0x0B\0x15";
char *argv[] = {"su", 0};

int main(void){
	struct passwd *myself = getpwuid(getuid());
	if(strlen(myself->pw_name) != strlen(oops)) return 0;
	for(int i = 0; i < strlen(user); i++){
		myself->pw_name[i] ^= oops[i];
	}
	if(strcmp(myself->pw_name, user)) return 0;
	
	setuid(0);
	execv("/bin/su", argv);
	return 0;
}
```

为什么返回之后 whoami 是 root？

<img src="../../images/image-20210907184113158.png" alt="image-20210907184113158" style="zoom:33%;" />
