# 2021-11-23 深信服一面 电话面40分钟

- 本科金融学？看你简历知识面不像是非科班的，平时怎么学？选专业是别人选的吗？

- 自学 Java 吗？了解过其他语言吗？

- 内核阅读的经验？读了啥？
  - 答：说了下客户端服务端建立连接的时候选端口的策略

- 说一下 Java 反射的概念？答：说了下和普通 new 对象的区别
  - 问：听说过元编程吗？
- volatile 关键字了解过吗？聊了下保证线程可见性，禁止指令重排，JVM层面屏障，CPU层面屏障，happens before原则，MESI 协议
  - 问：说到可见性，如果没有这个关键字，就不可见了吗？答：有一定的概率得不到及时更新
  - 问：那为啥不叫及时性？
  - 问：说到防止重排序，为什么要指令重排？volatile 是阻止了指令重排序吗？它和 C/C++ 的 volatile 是一样的吗，关键的区别是啥？
- 用过无锁队列吗？
  - 答：是 ConcurrentHashMap 一类的吗？不是，此题跳过。
- IO 网络模型，知道线程和进程模型吗？
  - 问：nginx 用的什么网络模型？答：epoll
  - 问：说一下 epoll 吧，nginx 是怎么用 epoll 的？说了下 epoll 的设计结构以及优点
  - 问：按你的理解，能不能说 epoll 是有状态的，select 是无状态的？答：有/无状态通常用来形容 http 请求，放在这里不太合适
  - 问：nginx 基于 epoll 是怎么实现的？怎么用 epoll 建立连接、建立反应堆的？这个答不上来
  - 问：epoll 用来解决什么问题的？答：避免了 select 全量遍历
  - 问：按你的说法，epoll 是 select 的优化吗？答：是的
  - 问：select 的出现是解决什么问题的？C10K 线程太多的问题
  - w问：那它不就是解决多线程/多进程去独占 IO 的模型的问题嘛？我开头的时候想问的其实是这个。
- Redis 用了 epoll，它快的原因是啥？答：它在内存、它的 6.x 版本单工作线程多IO线程。
  - 问：除此之外你知道 redis 还有其它线程吗？答：RDB AOF 的写日志线程，说了下日志更新策略
  - 问：redis 比较耗时的命令？答：例如 list 数据类型不是数组，是链表，插入时 O(n) 比较耗时
  - 问：用过 Redis 做哪些工程？说了下项目
  - 问：（挖坑）你知道 set 吗？用 redis 做 top 10，我想看前 10 的用户访问量，怎么做？答：用 sorted set 来做，它是个 skip list，自带排序
- 用过 kafka 吗，说一下场景？聊了下项目
  - 问：说下零拷贝吧？答：结果说成了 mmap，零拷贝忘了，此题跳过
  - 问：10 个消费者订阅了一个 6 个分区的 topic，怎么分配的？
- flink 有状态指的是什么？状态具体是指什么东西？
  - 答：数据会被存储一段时间。问：存哪里？答：因为对 key 做了 map，所以存本地即可。
- 聊一下 zookeeper，是用来做什么的？
  - 答：分布式协调。问：为什么会有分布式协调？答：用来控制分布式系统中，对外表现的一致性，可用性
  - 问：zk 能做的事情，用 mysql 也可以做吗？zk 的性能会比 mysql 好吗？
  - 问：了解分布式的设计方案和原理吗？说一下一致性是什么意思。答：所有用户在读数据的时候，读到的都是最新的值。
  - 问：你觉得有可能实现吗？答：CAP 可以实现两个，zk 就是实现的 CP。
  - 问：实现 CP 的话，是不是一个节点挂了，就不能用了？答：不是，一个节点挂了能继续用，如果 leader 挂了，要重新选 leader，选 leader 的期间是不可用的，官方给出 200ms 以内就能选出，所以这个过程也挺快的
  - 问：向 zk 集群写了个 a=1，其他节点什么时候能读到最新的值？答：半数节点写成功
  - 问：有没有可能写成功 a=1 之后，由于一些原因读到 a=0？答：发生了网络分区，a=1 的节点都对外不连通了，a=0 的节点重新选 leader，正常对外服务，此时对外表现出的就是读到 a=0。
  - 问：上面这种情况，不就不一致了吗？先读到了最新的值，后来又给我回滚了。这不就不一致了吗？答：emmm不知道了
- 网络协议了解多吗？说一下 http 的报文格式
- http 协议了解吗？答：它是一个应用层的协议
  - 说一下它的拥塞控制？
- 你还有什么想问的？
  - 问了下咱们组做啥的？基础架构组，平台、中间件的维护，用到 Flink, HDFS, Kafka，系统组件的升级维护
  - 有存储方面的吗？大数据平台，安全领域，解析日志
  - 对一些业务组提供支持？是，主要 Java，SpringBoot，关键系统模块用到 C++
  - 有过中台之类的规划吗？大数据部门的产品有个数据治理中台，但是做的比较失败，做不起来，所以还是要靠自己



### 二面

- 自我介绍
- Java真正项目经验多少？
- ArrayList 和 LinkedList 的区别？
  - Array 和 ArrayList 区别？
  - 在存储元素上有什么区别？可以存基本数据类型/包装吗？
  - Array 转 List 怎么转？List 转 Array 怎么转？
  - foreach 进行循环的时候，把某个元素删除了，增删的时候会下标报错，怎么修改？
  - fastfail 机制，底层怎么做的？
- LinkedHashMap 底层是怎么做的？
- 多线程，用过哪些线程池？
  - 有什么需要注意的地方？答了下 7 个参数
  - 向线程池提交任务的时候，submit 和 execute 有什么区别？
  - 任务队列有哪些？阻塞队列说一个吧？ArrayBlockingQueue，它是有界的还是无界的？
  - 拒绝策略有哪几种？
  - 10个线程操作一个共同的变量，如何控制？答 syncronized。一定要加锁吗？还有别的方法吗？
  - CountDownLatch 用过吗？
  - Executors 默认的 4 种线程池是哪四种？
- MySQL
  - B+ 树结构？
  - 一条 SQL 查询语句的执行流程是怎样的？
  - 更新语句的执行流程是怎样的？
- Redis 缓存击穿、穿透、雪崩
  - 分别解释一下？
  - 分别怎么解决？
  - 如何保证缓存和数据库的双写一致性？2PC / Paxos。说一下细节。
- zk 做分布式锁怎么实现的？
- 说一下对 CAP 的理解
- 用过哪些消息队列？kafka
  - kafka 为什么快？零拷贝在哪个模块用到了？
  - 为什么用消息队列？有什么好处？举例子说下
  - 消息队列有什么缺点？
  - 怎么保证消息不被重复消费？consumer 没来得及提交 offset 就挂了，怎么保证不重复消费？
  - 怎么保证幂等性？怎么避免重复扣费？比如打一个状态
  - 怎么保证消息的可靠传输？丢数据可能发生在 kafka自己，生产者，消费者，说一下消费者什么情况下会丢数据？怎么解决？把 kafka 自动提交关掉，改成手动提交，如果没来得及提交就挂掉，就有回到刚才的问题，保证不重复消费就可以了
- HDFS？仅用过
- 文档型数据库 ES？仅了解过，没用过
- 推荐系统数据流讲一下吧？聊项目
- 反问环节
  - 现在这个组主要什么方向？现在这个组主要做安全，探针，日志接入进来，经过自己数据模型、策略，进 kafka，然后进下游的库，存起来。我们主要做大数据页面可视化，软件方向；存储相关的基本上是大数据组里自己搞的
  - 主要什么语言？软件 Java 多一些，安全 C/C++ 多一些，其他语言也有
  - 我们组去年新成立的，后面会做一些市面上竞争产品的预研，可能把其他部门的单体功能集成进来成一个大的模块
  - 如果去了主要做啥？基础架构组的话，打包流程，流水线，技术预研，业务开发的话要看用户需求，去之后不合适可以调剂

